<!DOCTYPE html>
<html>
<head>
  <title>Smallo Kitchen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background:#f5f5f5;
    }

    #ordersContainer {
      padding:15px;
      display:grid;
      gap:15px;
    }

    .orderCard {
      background:white;
      padding:15px;
      border-radius:14px;
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
      transition:0.4s ease;
    }

    .orderCard.fadeOut {
      opacity:0;
      transform:scale(0.95);
    }

    .orderCard.slideOut {
      transform:translateX(-100%);
      opacity:0;
    }

    .orderHeader {
      font-weight:bold;
      margin-bottom:8px;
      font-size:18px;
    }

    .items {
      font-size:14px;
      margin-bottom:10px;
    }

    .btnRow {
      display:flex;
      gap:10px;
    }

    button {
      flex:1;
      padding:8px;
      border:none;
      border-radius:8px;
      cursor:pointer;
    }

    .completeBtn {
      background:#4CAF50;
      color:white;
    }

    .cancelBtn {
      background:#e53935;
      color:white;
    }

    .confirmBox {
      margin-top:8px;
      background:#ffecec;
      padding:8px;
      border-radius:8px;
      font-size:13px;
      display:none;
    }

    .confirmBox button {
      margin-top:6px;
      background:#e53935;
      color:white;
      padding:6px;
      border-radius:6px;
      width:100%;
    }
  </style>
</head>
<body>

<div id="ordersContainer"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC7FVnMrkhPIF3fJE0JZEmwjDALSFc7SFc",
    authDomain: "smallo-live.firebaseapp.com",
    databaseURL: "https://smallo-live-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "smallo-live",
    storageBucket: "smallo-live.firebasestorage.app",
    messagingSenderId: "1017470725882",
    appId: "1:1017470725882:web:929ee126247fcbb51e6343",
    measurementId: "G-QTZTK6G2XL"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const container = document.getElementById("ordersContainer");

  db.ref("orders").on("value", snapshot => {

    container.innerHTML = "";

    if (!snapshot.exists()) return;

    snapshot.forEach(child => {

      const order = child.val();
      const orderId = child.key;

      if (!order || order.status !== "preparing") return;

      // SAFE ITEMS PARSE
      let itemsHtml = "No items";
      if (Array.isArray(order.items)) {
        itemsHtml = order.items.map(i => {
          return `${i.item || ""} (${i.size || ""}, ${i.syrup || ""}) x${i.quantity || 1}`;
        }).join("<br>");
      }

      const card = document.createElement("div");
      card.className = "orderCard";

      card.innerHTML = `
        <div class="orderHeader">
          Order #${order.orderNumber || "---"}
        </div>
        <div class="items">
          ${itemsHtml}
        </div>
        <div class="btnRow">
          <button class="completeBtn">Complete</button>
          <button class="cancelBtn">Cancel</button>
        </div>
        <div class="confirmBox">
          Are you sure you want to cancel?
          <button>Confirm Cancel</button>
        </div>
      `;

      container.appendChild(card);

      const completeBtn = card.querySelector(".completeBtn");
      const cancelBtn = card.querySelector(".cancelBtn");
      const confirmBox = card.querySelector(".confirmBox");
      const confirmCancelBtn = confirmBox.querySelector("button");

      // COMPLETE
      completeBtn.onclick = () => {

        db.ref("orders/" + orderId).update({
          status: "completed"
        }).then(() => {

          return db.ref("orders/" + orderId).remove();

        }).then(() => {

          card.classList.add("fadeOut");

          setTimeout(() => {
            card.remove();
          }, 400);

        }).catch(console.error);
      };

      // CANCEL
      cancelBtn.onclick = () => {
        confirmBox.style.display = "block";
      };

      confirmCancelBtn.onclick = () => {

        db.ref("orders/" + orderId).remove().then(() => {

          card.classList.add("slideOut");

          setTimeout(() => {
            card.remove();
          }, 400);

        }).catch(console.error);
      };

    });

  });
</script>

</body>
</html>
 
