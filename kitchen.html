<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smallo Kitchen</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:#583621;
}

header{
  background:#6b8e6e;
  color:white;
  padding:18px;
  text-align:center;
  font-size:22px;
  border-bottom-left-radius:20px;
  border-bottom-right-radius:20px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  gap:18px;
  padding:18px;
}

.card{
  background:#FFF5E1;
  border-radius:20px;
  padding:15px;
  box-shadow:0 6px 16px rgba(0,0,0,0.15);
  position:relative;
  transition:transform .15s;
}

.card:hover{
  transform:scale(1.02);
}

.orderNumber{
  font-size:22px;
  font-weight:bold;
  color:#583621;
  margin-bottom:10px;
}

.itemRow{
  font-size:14px;
  margin-bottom:6px;
}

.total{
  font-weight:bold;
  margin-top:8px;
}

button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  margin-top:8px;
}

.completeBtn{
  background:#6b8e6e;
  color:white;
}

.cancelBtn{
  background:#b13a3a;
  color:white;
}

.confirmBox{
  background:#ffe0e0;
  padding:10px;
  border-radius:12px;
  margin-top:8px;
  text-align:center;
}

.smallBtn{
  width:48%;
  padding:6px;
  font-size:12px;
  border-radius:8px;
}

.fadeOut {
  animation: fadeOutAnim 0.4s forwards;
}

@keyframes fadeOutAnim {
  from { opacity: 1; transform: scale(1); }
  to { opacity: 0; transform: scale(0.95); }
}

.slideLeft {
  animation: slideLeftAnim 0.4s forwards;
}

@keyframes slideLeftAnim {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(-60px); }
}

</style>
</head>
<body>

<header>üç≥ Kitchen Orders</header>
<div class="grid" id="ordersGrid"></div>

<script>

/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyC7FVnMrkhPIF3fJE0JZEmwjDALSFc7SFc",
  authDomain: "smallo-live.firebaseapp.com",
  databaseURL: "https://smallo-live-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "smallo-live",
  storageBucket: "smallo-live.firebasestorage.app",
  messagingSenderId: "1017470725882",
  appId: "1:1017470725882:web:929ee126247fcbb51e6343",
  measurementId: "G-QTZTK6G2XL"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const grid = document.getElementById("ordersGrid");

db.ref("orders").on("value",snap=>{
  grid.innerHTML="";

  snap.forEach(child=>{
    const data = child.val();
    const orderNum = data.orderNumber;

    const card = document.createElement("div");
    card.className="card";
    card.id="card_"+orderNum;

    let itemsHTML="";
    data.items.forEach(i=>{
      let toppingsText = i.toppings && i.toppings.length>0 ?
        " | "+i.toppings.join(", ") : "";

      itemsHTML+=`
        <div class="itemRow">
          ${i.item} (${i.size}, ${i.syrup})
          ${toppingsText}
          <br>
          ${i.quantity}x
        </div>
      `;
    });

    card.innerHTML=`
      <div class="orderNumber">#${orderNum}</div>
      ${itemsHTML}
      <div class="total">Total: ‚Ç±${data.total}</div>
      <button class="completeBtn" onclick="completeOrder('${orderNum}')">Mark Completed</button>
      <button class="cancelBtn" onclick="showCancel('${orderNum}')">Cancel Order</button>
      <div id="confirm_${orderNum}"></div>
    `;

    grid.appendChild(card);
  });
});

function completeOrder(orderNum){
  const card = document.getElementById("card_"+orderNum);
  card.classList.add("fadeOut");

  setTimeout(()=>{
    const ref = db.ref("orders/"+orderNum);
    ref.once("value",snap=>{

      const orderData = snap.val();

      // SEND TO GOOGLE SHEETS
      fetch("https://script.google.com/macros/s/AKfycby-xead888xnj_IHDO3HX8vygNaOcekg2sh4yhLy44dlyDJy5fJ4w2fqMTEHFgN9tAWdg/exec", {
  method: "POST",
  body: JSON.stringify({
    orderNumber: order.orderNumber,
    items: JSON.stringify(order.items), // IMPORTANT
    total: order.total,
    completedAt: new Date().toISOString()
  })
});


      db.ref("completedOrders/"+orderNum).set({
        ...orderData,
        completedAt:Date.now()
      });

      ref.remove();

    });
  },400);
}


function showCancel(orderNum){
  const box = document.getElementById("confirm_"+orderNum);
  box.innerHTML=`
    <div class="confirmBox">
      Cancel this order?
      <div style="display:flex; justify-content:space-between; margin-top:8px;">
        <button class="smallBtn" onclick="confirmCancel('${orderNum}')">Yes</button>
        <button class="smallBtn" onclick="hideCancel('${orderNum}')">No</button>
      </div>
    </div>
  `;
}

function hideCancel(orderNum){
  document.getElementById("confirm_"+orderNum).innerHTML="";
}

function confirmCancel(orderNum){
  const card = document.getElementById("card_"+orderNum);
  card.classList.add("slideLeft");

  setTimeout(()=>{
    db.ref("orders/"+orderNum).remove();
  },400);
}

</script>

</body>
</html>
