<!DOCTYPE html>
<html>
<head>
  <title>Smallo Display</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* LEFT */
    #menu {
      width: 50%;
      background: #6b8e6e;
      padding: 10px;
      box-sizing: border-box;
      overflow: auto;
    }

    /* RIGHT */
    #right {
      width: 50%;
      display: flex;
      flex-direction: column;
    }

    /* SMALLO CORNER */
    #smallo {
      height: 50%;
      background: #fff5e1;
      position: relative;
      overflow: hidden;
    }

    #smallo video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    #idleVideo {
      z-index: 1;
    }

    #actionVideo {
      z-index: 2;
      opacity: 0;
      pointer-events: none;
      transition: opacity 120ms linear;
    }

    /* PRODUCTS */
    #products {
      height: 50%;
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #products img {
      max-width: 100%;
      max-height: 100%;
    }

    /* FULLSCREEN */
    #fs {
      position: fixed;
      bottom: 6px;
      right: 6px;
      width: 44px;
      height: 44px;
      opacity: 0.12;
      z-index: 20;
    }
  </style>
</head>
<body>

  <!-- MENU -->
  <div id="menu">
    <div style="position: relative; width: 100%; height: 0; padding-top: 125.0000%;
     padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
     border-radius: 8px; will-change: transform;">
      <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
        src="https://www.canva.com/design/DAHA6CJLYFc/pb-pX-AMcbC9I1zxRAJEAg/view?embed"
        allowfullscreen="allowfullscreen" allow="fullscreen">
      </iframe>
    </div>
    <a href="https://www.canva.com/design/DAHA6CJLYFc/pb-pX-AMcbC9I1zxRAJEAg/view?utm_content=DAHA6CJLYFc&utm_campaign=designshare&utm_medium=embeds&utm_source=link"
       target="_blank" rel="noopener">
      Copy of Green and White Retro Matcha Instagram Post
    </a>
  </div>

  <!-- DISPLAY -->
  <div id="right">
    <div id="smallo">
      <!-- IDLE NEVER STOPS -->
      <video id="idleVideo" autoplay muted loop preload="auto">
        <source src="videos/idle.mp4" type="video/mp4">
      </video>

      <!-- ACTION OVERLAY -->
      <video id="actionVideo" muted preload="auto"></video>
    </div>

    <div id="products">
      <img id="productImg" src="products/product1.jpg">
    </div>
  </div>

  <button id="fs"></button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC7FVnMrkhPIF3fJE0JZEmwjDALSFc7SFc",
      authDomain: "smallo-live.firebaseapp.com",
      databaseURL: "https://smallo-live-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "smallo-live",
      storageBucket: "smallo-live.firebasestorage.app",
      messagingSenderId: "1017470725882",
      appId: "1:1017470725882:web:929ee126247fcbb51e6343"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const actionVideo = document.getElementById("actionVideo");
    let busy = false;

    function playAction(name) {
      if (busy) return;
      busy = true;

      actionVideo.src = `videos/${name}.mp4`;
      actionVideo.currentTime = 0;

      actionVideo.onloadeddata = () => {
        actionVideo.style.opacity = 1;
        actionVideo.play();
      };

      actionVideo.onended = () => {
        actionVideo.style.opacity = 0;
        busy = false;
      };
    }

    db.ref("action").on("value", snap => {
      const val = snap.val();
      if (!val || val === "idle") return;
      playAction(val);
    });

    /* RANDOM BLINK */
    setInterval(() => {
      if (!busy && Math.random() < 0.45) {
        playAction("blink");
      }
    }, 9000);

    /* FULLSCREEN */
    document.getElementById("fs").onclick = () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      }
    };

    /* PRODUCT ROTATION */
    const imgs = [
      "products/product1.jpg",
      "products/product2.jpg",
      "products/product3.jpg"
    ];
    let i = 0;
    setInterval(() => {
      i = (i + 1) % imgs.length;
      productImg.src = imgs[i];
    }, 3000);
  </script>

</body>
</html>
#85c9e5
