<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smallo Display</title>

  <!-- Firebase (compat version used earlier) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif}
    /* layout */
    #container { display:flex; width:100%; height:100vh; }
    #menu { width:50%; background:#6b8e6e; padding:12px; box-sizing:border-box; overflow:auto; }
    #right { width:50%; display:flex; flex-direction:column; }

    /* smallo area */
    #smallo { height:50%; background:#fff5e1; position:relative; overflow:hidden; }
    #smallo video { position:absolute; inset:0; width:100%; height:100%; object-fit:contain; background:transparent; }
    #idleVideo { z-index:1; }
    #actionVideo { z-index:2; opacity:0; transition:opacity 140ms linear; pointer-events:none; }

    /* product preview crossfade (two images) */
    #productPreview { height:50%; background:#000; position:relative; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    .productImg { position:absolute; inset:0; margin:auto; max-width:100%; max-height:100%; object-fit:contain; transition:opacity 0.6s ease; }

    /* fullscreen button - visible and high z-index */
    #fsBtn {
      position: fixed;
      top: 12px;
      right: 12px;
      padding: 8px 12px;
      background: rgba(0,0,0,0.5);
      color: #fff;
      border-radius: 10px;
      z-index: 2147483647; /* very high */
      font-size:14px;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
    }

    /* pseudo-fullscreen fallback (applied to #container) */
    .pseudo-fullscreen {
      position: fixed !important;
      inset: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 2147483646 !important;
      background: #000;
    }
  </style>
</head>
<body>

<div id="container">
  <!-- LEFT: CANVA (unchanged) -->
  <div id="menu">
    <div style="position: relative; width: 100%; height: 0; padding-top: 125.0000%;
     padding-bottom: 0; box-shadow: 0 2px 8px 0 rgba(63,69,81,0.16); margin-top: 1.6em; margin-bottom: 0.9em; overflow: hidden;
     border-radius: 8px; will-change: transform;">
      <iframe loading="lazy" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; border: none; padding: 0;margin: 0;"
        src="https://www.canva.com/design/DAHA6CJLYFc/pb-pX-AMcbC9I1zxRAJEAg/view?embed" allowfullscreen="allowfullscreen" allow="fullscreen">
      </iframe>
    </div>
    <a href="https://www.canva.com/design/DAHA6CJLYFc/pb-pX-AMcbC9I1zxRAJEAg/view" target="_blank" rel="noopener" style="color:#fff">Open in Canva</a>
  </div>

  <!-- RIGHT: smallo + products -->
  <div id="right">
    <div id="smallo">
      <video id="idleVideo" autoplay muted playsinline preload="auto" loop>
        <source src="videos/idle.mp4" type="video/mp4">
      </video>
      <video id="actionVideo" muted playsinline preload="auto"></video>
    </div>

    <div id="productPreview">
      <img id="imgA" class="productImg" src="product-previews/1.png" style="opacity:1">
      <img id="imgB" class="productImg" src="product-previews/2.png" style="opacity:0">
    </div>
  </div>
</div>

<!-- fullscreen button -->
<div id="fsBtn" aria-hidden="false">⛶ Fullscreen</div>

<script>
  /* ================= FIREBASE CONFIG ================= */
  const firebaseConfig = {
    apiKey: "AIzaSyC7FVnMrkhPIF3fJE0JZEmwjDALSFc7SFc",
    authDomain: "smallo-live.firebaseapp.com",
    databaseURL: "https://smallo-live-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "smallo-live",
    storageBucket: "smallo-live.firebasestorage.app",
    messagingSenderId: "1017470725882",
    appId: "1:1017470725882:web:929ee126247fcbb51e6343",
    measurementId: "G-QTZTK6G2XL"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  /* ================= DOM refs ================= */
  const container = document.getElementById('container');
  const fsBtn = document.getElementById('fsBtn');
  const idleVideo = document.getElementById('idleVideo');
  const actionVideo = document.getElementById('actionVideo');

  /* ================= Product crossfade (unchanged logic, only included) ================= */
  const productImgs = [
    "product-previews/1.png",
    "product-previews/2.png",
    "product-previews/3.png",
    "product-previews/4.png",
    "product-previews/5.png"
  ];
  let pIdx = 0;
  let showingA = true;
  const imgA = document.getElementById('imgA');
  const imgB = document.getElementById('imgB');

  setInterval(() => {
    pIdx = (pIdx + 1) % productImgs.length;
    const incoming = showingA ? imgB : imgA;
    const outgoing = showingA ? imgA : imgB;
    incoming.src = productImgs[pIdx];
    incoming.style.opacity = 1;
    outgoing.style.opacity = 0;
    showingA = !showingA;
  }, 4000);

  /* ================= Robust fullscreen routine =================
     - Try standard Fullscreen API
     - Try vendor prefixed (webkit/ms)
     - If none available or denied, use pseudo-fullscreen CSS fallback
     - Toggle behavior: entering/exiting updates button text
  ============================================================*/

  function isInFullscreen() {
    return !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement || container.classList.contains('pseudo-fullscreen'));
  }

  function enterPseudoFullscreen() {
    // fallback UI: pin the container to viewport
    container.classList.add('pseudo-fullscreen');
    fsBtn.textContent = '✕ Exit';
  }
  function exitPseudoFullscreen() {
    container.classList.remove('pseudo-fullscreen');
    fsBtn.textContent = '⛶ Fullscreen';
  }

  function tryEnterNativeFullscreen() {
    const el = document.documentElement; // try the full document
    if (el.requestFullscreen) return el.requestFullscreen();
    if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
    if (el.msRequestFullscreen) return el.msRequestFullscreen();
    return Promise.reject(new Error('No native fullscreen API'));
  }

  function tryExitNativeFullscreen() {
    if (document.exitFullscreen) return document.exitFullscreen();
    if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
    if (document.msExitFullscreen) return document.msExitFullscreen();
    return Promise.reject(new Error('No native exitFullScreen'));
  }

  // Main toggle function (called on direct user gesture)
  fsBtn.addEventListener('click', () => {
    // Important: run directly inside click handler to satisfy user-gesture requirement
    if (!isInFullscreen()) {
      // Attempt native fullscreen first
      tryEnterNativeFullscreen().then(() => {
        fsBtn.textContent = '✕ Exit';
      }).catch(() => {
        // native failed or unsupported: fallback to pseudo
        enterPseudoFullscreen();
      });
    } else {
      // Exit fullscreen: either native or pseudo
      tryExitNativeFullscreen().then(() => {
        fsBtn.textContent = '⛶ Fullscreen';
      }).catch(() => {
        // if native exit fails, remove pseudo class
        exitPseudoFullscreen();
      });
    }
  });

  // If the browser changes fullscreen state externally, update button
  document.addEventListener('fullscreenchange', () => {
    if (!isInFullscreen()) fsBtn.textContent = '⛶ Fullscreen';
  });
  document.addEventListener('webkitfullscreenchange', () => {
    if (!isInFullscreen()) fsBtn.textContent = '⛶ Fullscreen';
  });
  document.addEventListener('msfullscreenchange', () => {
    if (!isInFullscreen()) fsBtn.textContent = '⛶ Fullscreen';
  });

  /* =============== WHY THIS FIXES TABLET ISSUES ===============
     - Some tablets (especially iPad Safari) either don't implement
       the Fullscreen API for the whole document or require stricter
       gestures. The fallback guarantees the display will "take over"
       the screen area even if native API isn't available.
     - The button is placed outside the iframe region, has a very high
       z-index, and is large enough to tap comfortably.
     - We avoid async wrappers so the click is a "direct user gesture",
       increasing the chance the browser allows fullscreen.
  ============================================================*/

  /* ================= Smallo / queue logic remains unchanged =================
     (This file assumes your existing queue consumer and action overlay logic
      is in place elsewhere in the script; no changes here.)
  ========================================================================== */

</script>
</body>
</html>
 
